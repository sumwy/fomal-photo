# 운전면허 사진 가이드 웹 애플리케이션

## 프로젝트 소개

본 프로젝트는 웹 브라우저에서 운전면허 사진을 촬영할 수 있도록 가이드라인을 제공하고, 사진 촬영 기능을 제공하는 웹 애플리케이션입니다. HTML, CSS, JavaScript로 개발되었으며, 웹 표준 기술을 사용하여 카메라 접근 및 이미지 캡처 기능을 구현했습니다.

## 주요 기능

*   **카메라 접근 및 화면 표시:** WebRTC API를 사용하여 웹 브라우저에서 카메라에 접근하고, 실시간 카메라 미리보기 화면을 제공합니다.
*   **운전면허 사진 가이드라인 표시:** 캔버스를 사용하여 운전면허 사진 규정에 맞는 가이드라인을 화면에 표시하여 사용자가 사진 구도를 잡도록 돕습니다.
*   **사진 촬영 기능:** "사진 촬영" 버튼을 클릭하면 현재 카메라 화면을 캡처하여 화면에 표시합니다.
*   **얼굴 위치 자동 보정:** OpenCV의 얼굴 인식 기술을 활용하여 눈 위치와 얼굴 중앙이 표준 규격에 맞도록 자동으로 조정합니다.
*   **배경 제거 기능:** 촬영된 사진에서 배경을 자동으로 제거하고 흰색 배경으로 대체합니다.
*   **이미지 보정 기능:** 피부 보정, 눈 보정, 선명도 개선 등 다양한 보정 기능을 제공합니다.
*   **다운로드 기능:** 보정된 이미지를 다운로드할 수 있는 기능을 제공합니다.

## 시스템 요구사항

* **운영체제:** Windows, macOS, Linux (모든 주요 운영체제 지원)
* **웹 브라우저:** Chrome, Firefox, Safari, Edge 최신 버전
* **Python:** 3.8 이상
* **카메라:** 웹캠 또는 모바일 카메라
* **인터넷 연결:** 필요 (의존성 패키지 설치 시)

## 설치 및 실행 방법

### 1. 저장소 복제

```bash
git clone https://github.com/your-repo/fomal-photo.git
cd fomal-photo
```

### 2. 의존성 설치 및 실행

#### 자동 설치 (권장)

```bash
# 실행 권한 부여
chmod +x setup.sh

# 설치 및 실행 스크립트 실행
./setup.sh
```

#### 수동 설치

```bash
# 가상 환경 생성 및 활성화
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 기본 의존성 설치
pip install Flask==3.0.2 Pillow==10.2.0 opencv-python==4.9.0.80 numpy==1.26.4 python-dotenv==1.0.1 rembg onnxruntime

# 나머지 의존성 설치
pip install -r backend/requirements.txt

# 애플리케이션 실행
export FLASK_APP=backend/src/app.py
export FLASK_ENV=development
flask run --host=0.0.0.0 --port=5001
```

### 3. 웹 애플리케이션 접속

웹 브라우저에서 다음 주소로 접속합니다:
```
http://localhost:5001
```

## 사용 방법

1. **카메라 접근 허용:** 웹 브라우저에서 카메라 접근 권한을 요청하면 '허용'을 클릭합니다.
2. **가이드라인 확인:** 화면에 표시된 가이드라인을 참고하여 얼굴 위치를 조정합니다.
   - 눈 위치가 상단 가이드라인 사이에 오도록 조정
   - 얼굴이 중앙 세로선에 맞도록 조정
3. **사진 촬영:** '사진 촬영' 버튼을 클릭하여 사진을 촬영합니다.
4. **자동 보정:** 시스템이 자동으로 얼굴 위치를 보정하고 배경을 제거합니다.
5. **결과 확인:** 보정된 사진을 확인합니다.
6. **다운로드:** '다운로드' 버튼을 클릭하여 최종 이미지를 저장합니다.

## 주요 기능 설명

### 가이드라인 기능

- **표준 규격 표시:** 3.5cm x 4.5cm 비율의 사진 영역 표시
- **눈높이 가이드:** 상단에서 32-36% 위치에 눈이 오도록 가이드라인 제공
- **중앙 위치 가이드:** 얼굴이 중앙에 오도록 세로 가이드라인 제공
- **가이드라인 토글:** '가이드라인' 버튼을 클릭하여 가이드라인 표시/숨김 전환 가능

### 얼굴 위치 자동 보정

- **얼굴 인식:** OpenCV의 Haar Cascade 분류기를 사용하여 얼굴 위치 감지
- **위치 조정:** 얼굴이 중앙에 오도록 자동 조정
- **눈 위치 조정:** 눈이 표준 위치(상단 34% 위치)에 오도록 자동 조정

### 이미지 보정 기능

- **배경 제거:** rembg 라이브러리를 사용하여 배경 제거 및 흰색 배경으로 대체
- **피부 보정:** bilateral filter를 사용하여 피부 톤 개선
- **눈 보정:** 대비 향상을 통한 눈 선명도 개선
- **선명도 개선:** 전체적인 이미지 선명도 향상

## 구글 애드센스 통합

이 프로젝트는 구글 애드센스를 통한 광고 표시를 지원합니다. 다음과 같은 광고 형식이 구현되어 있습니다:

### 광고 형식 및 위치

1. **디스플레이 광고**
   - 왼쪽 및 오른쪽 사이드바에 표시
   - 사이드바 내 가이드 영역 하단에 표시
   - 반응형으로 구현되어 다양한 화면 크기에 적응

2. **인피드 광고**
   - 카메라 영역과 썸네일 목록 사이에 표시
   - 콘텐츠와 자연스럽게 어울리는 형태로 구현

3. **멀티플렉스 광고**
   - 페이지 하단에 표시
   - 여러 광고를 그리드 형태로 표시하는 형식

### 광고 설정 방법

1. **애드센스 계정 연결**
   - Google AdSense 계정을 생성하고 사이트를 등록합니다.
   - 제공된 코드를 `<head>` 태그 내에 삽입합니다.

2. **광고 단위 설정**
   - 각 광고 위치에 맞는 광고 단위를 생성합니다.
   - 생성된 광고 단위 코드의 `data-ad-client` 및 `data-ad-slot` 값을 업데이트합니다.

3. **광고 형식 최적화**
   - 디스플레이 광고: `data-ad-format="auto"` 및 `data-full-width-responsive="true"` 설정
   - 인피드 광고: `data-ad-format="fluid"` 및 적절한 `data-ad-layout-key` 설정
   - 멀티플렉스 광고: `data-ad-format="autorelaxed"` 설정

## 문제 해결

### 카메라 접근 오류

- **권한 문제:** 브라우저 설정에서 카메라 접근 권한을 확인하세요.
- **장치 인식 문제:** 다른 애플리케이션에서 카메라를 사용 중인지 확인하세요.

### 얼굴 인식 실패

- **조명 조건:** 충분한 조명이 있는 환경에서 사용하세요.
- **얼굴 위치:** 얼굴이 화면 중앙에 오도록 조정하세요.

### 설치 문제

- **OpenCV 설치 오류:** 다음 명령으로 필요한 시스템 라이브러리를 설치하세요:
  ```bash
  # Ubuntu/Debian
  sudo apt-get install build-essential cmake libopenblas-dev liblapack-dev
  
  # macOS
  brew install cmake
  ```

- **rembg 설치 오류:** 다음 명령으로 직접 설치해보세요:
  ```bash
  pip install rembg
  ```

### 광고 표시 문제

- **광고 차단기:** 사용자의 광고 차단기가 광고 표시를 방해할 수 있습니다.
- **광고 로딩 지연:** 네트워크 상태에 따라 광고 로딩이 지연될 수 있습니다.
- **광고 슬롯 ID:** 올바른 광고 슬롯 ID가 설정되었는지 확인하세요.

## 참고

*   본 프로젝트는 웹 표준 기술을 기반으로 개발되었으므로, 최신 웹 브라우저 (Chrome, Firefox, Safari 등)에서 정상적으로 작동합니다.
*   카메라 접근 권한이 필요하며, HTTPS 환경에서 실행하는 것을 권장합니다 (일부 브라우저 정책).
*   얼굴 인식 및 이미지 처리는 서버 측에서 처리되므로 인터넷 연결이 필요합니다.
*   광고 수익은 Google AdSense 정책에 따라 결정되며, 트래픽 및 사용자 참여도에 따라 달라질 수 있습니다.

## 문의

프로젝트 관련 문의사항이나 개선 제안이 있으시면 언제든지 연락 주세요.

[thspade@gmail.com](mailto:thspade@gmail.com)

## Docker를 사용한 배포 가이드

이 프로젝트는 Docker를 사용하여 쉽게 배포할 수 있습니다. 다음 단계를 따라 애플리케이션을 배포하세요.

### 사전 요구사항

- [Docker](https://www.docker.com/get-started) 설치
- [Docker Compose](https://docs.docker.com/compose/install/) 설치 (대부분의 Docker 설치에 포함됨)

### 배포 단계

1. 프로젝트 클론하기
   ```bash
   git clone <repository-url>
   cd fomal-photo
   ```

2. Docker 이미지 빌드 및 실행
   ```bash
   docker-compose up -d --build
   ```

3. 애플리케이션 접속
   - 웹 브라우저에서 `http://localhost:5001` 접속

### 서버 관리

- 서버 중지
  ```bash
  docker-compose down
  ```

- 로그 확인
  ```bash
  docker-compose logs -f
  ```

- 서버 재시작
  ```bash
  docker-compose restart
  ```

### 클라우드 서비스에 배포하기

#### AWS EC2 배포

1. EC2 인스턴스 생성 및 SSH 접속
2. Docker 및 Docker Compose 설치
3. 프로젝트 클론 및 배포
   ```bash
   git clone <repository-url>
   cd fomal-photo
   docker-compose up -d --build
   ```
4. 보안 그룹에서 5001 포트 개방

#### Google Cloud Platform 배포

1. Compute Engine 인스턴스 생성 및 SSH 접속
2. Docker 및 Docker Compose 설치
3. 프로젝트 클론 및 배포
4. 방화벽 규칙에서 5001 포트 개방

### 도메인 연결 및 HTTPS 설정

1. 도메인 구매 및 DNS 설정
2. Nginx 또는 Traefik을 사용한 리버스 프록시 설정
3. Let's Encrypt를 통한 SSL 인증서 발급

### 애드센스 연결

1. 도메인이 연결된 후 Google AdSense 계정에 사이트 등록
2. 승인 후 실제 AdSense 코드로 임시 코드 교체
3. 광고 표시 확인 및 최적화

### 주의사항

- 프로덕션 환경에서는 보안을 위해 `FLASK_DEBUG=0`으로 설정되어 있습니다.
- 실제 서비스 배포 시 적절한 메모리와 CPU를 가진 서버를 선택하세요.
- 트래픽이 많을 경우 로드 밸런서 설정을 고려하세요.
